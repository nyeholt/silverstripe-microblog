!function(e){function t(t){for(var o,l,a=t[0],i=t[1],c=t[2],d=0,p=[];d<a.length;d++)l=a[d],n[l]&&p.push(n[l][0]),n[l]=0;for(o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o]);for(u&&u(t);p.length;)p.shift()();return r.push.apply(r,c||[]),s()}function s(){for(var e,t=0;t<r.length;t++){for(var s=r[t],o=!0,a=1;a<s.length;a++){var i=s[a];0!==n[i]&&(o=!1)}o&&(r.splice(t--,1),e=l(l.s=s[0]))}return e}var o={},n={0:0},r=[];function l(t){if(o[t])return o[t].exports;var s=o[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,l),s.l=!0,s.exports}l.m=e,l.c=o,l.d=function(e,t,s){l.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},l.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.t=function(e,t){if(1&t&&(e=l(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(l.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)l.d(s,o,function(t){return e[t]}.bind(null,o));return s},l.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return l.d(t,"a",t),t},l.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},l.p="";var a=window.webpackJsonp=window.webpackJsonp||[],i=a.push.bind(a);a.push=t,a=a.slice();for(var c=0;c<a.length;c++)t(a[c]);var u=i;r.push([161,1,2]),s()}({143:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=s(3),n=s(174);t.default=(({posts:e,expectedCount:t,loadChildren:s,loadMoreText:r})=>{const l=t&&t>0&&e.length<t;return e.sort((e,t)=>e.ID==t.ID?0:e.ID<t.ID?1:-1),o.createElement("div",{className:"MicroblogPostList"},e.map(e=>o.createElement(n.default,{post:e,key:e.ID})),l&&o.createElement("div",{className:"MicroblogPostList__LoadMore"},o.createElement("a",{href:"#",onClick:e=>{e.preventDefault(),s&&s()}},"↳ ",r||"Show replies","...")))})},144:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=s(3),n=s(5),r=s(9),l=s(195),a=s(196);const i=r.connect(e=>({savingPost:e.microblog.savingPost}),e=>({create:(t,s,o)=>e(n.createPost(t,s,o)),update:(t,s)=>e(n.updatePost(t,s)),cancel:()=>{e(n.editPost(null)),e(n.replyToPost(null))}}))(class extends o.Component{constructor(e){super(e),this.newPost=(e=>{e.preventDefault();const{editPost:t,extraProperties:s,target:o}=this.props;let n=t||s||{};if(n.Title=this.state.title,n.target=o,0===this.state.content.length)return;let r=this.props.editPost?this.props.update:this.props.create;r&&r(this.state.content,n),this.setState({id:null,content:"",title:""})}),this.getUploadParams=(e=>({url:"/api/v1/microblog/upload"})),this.handleChangeStatus=((e,t)=>{const{xhr:s}=e;if("done"===t){e.remove();const t=JSON.parse(s.responseText);if(t&&200==t.status){let e=this.state.content;const s=t.payload.MediaLink;this.setState({content:e+(e.length>0?"\n":"")+s})}}}),this.handleSubmit=((e,t)=>{t.forEach(e=>e.remove())}),this.state={id:null,title:"",content:""}}static getDerivedStateFromProps(e,t){return e.editPost&&e.editPost.ID!=t.id?{title:e.editPost.Title,content:e.editPost.OriginalContent?e.editPost.OriginalContent:e.editPost.Content,id:e.editPost.ID}:!e.editPost&&t.id?{id:null,content:"",title:""}:null}render(){const{showTitle:e,extraProperties:t,savingPost:s}=this.props,n={background:`transparent url(microblog/client/www/${a}) no-repeat`},r=t&&t.ParentID?"Reply...":"Say something...",i=s?"Saving...":this.props.editPost?"Update":"Post",c={getUploadParams:this.getUploadParams,onChangeStatus:this.handleChangeStatus,accept:"image/*,audio/*,video/*",multiple:!0,minSizeBytes:0,maxSizeBytes:1e7,maxFiles:10,canCancel:!0,canRemove:!0,canRestart:!1,styles:{},submitButtonContent:"",submitButtonDisabled:!0,inputContent:"⭱ Upload"};return o.createElement(o.Fragment,null,o.createElement("div",{className:"MicroblogForm"},o.createElement("div",{className:"MicroblogForm__Profile"},o.createElement("span",{role:"img",className:"MicroblogForm__Avatar",style:n})),o.createElement("div",{className:"MicroblogForm__Fields"},o.createElement("form",{onSubmit:e=>(e.preventDefault(),!1)},e&&o.createElement("div",{className:"MicroblogForm__Field"},o.createElement("input",{name:"title",value:this.state.title,onChange:e=>{const t=e.currentTarget.value;this.setState({title:t})}})),o.createElement("div",{className:"MicroblogForm__Field"},o.createElement("textarea",{placeholder:r,name:"content",value:this.state.content,onChange:e=>{const t=e.currentTarget.value;this.setState({content:t})}})),o.createElement("div",{className:"MicroblogForm__Actions"},o.createElement("button",{disabled:s,className:"MicroblogForm__Action__Default",onClick:this.newPost},i),o.createElement("button",{onClick:()=>{this.setState({id:null,content:"",title:""}),this.props.cancel&&this.props.cancel()}},"Cancel"),o.createElement("div",{className:"MicroblogForm__Files"},o.createElement("span",{className:"sr-only"},"Select or drag files to upload"),o.createElement(l.default,Object.assign({},c))))))))}});t.default=i},158:function(e,t,s){"use strict";var o;Object.defineProperty(t,"__esModule",{value:!0}),function(e){const t=5;let s,o,n={};function r(){const e=(new Date).getTime();for(let t in n){const s=n[t],o=s.lastUpdate?s.lastUpdate+1e3*s.frequency:0;(void 0===s.lastUpdate||o<e)&&l(s)}o=setTimeout(r,1e3*t)}function l(e){e.lastUpdate=(new Date).getTime(),e.callback&&e.callback(s.dispatch)}e.registerDataSource=function(e){s&&l(e),n[e.id]=e},e.removeDataSource=function(e){delete n[e]},e.setStore=function(e){s=e,r()},e.stopUpdates=function(){clearTimeout(o)}}(o||(o={})),t.default=o},161:function(e,t,s){s(162),s(163),e.exports=s(285)},163:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=s(3),n=s(165);s(169);const r=s(172),l=document.getElementsByClassName("Microblog");for(let e=0,t=l.length;e<t;e++){let t=l.item(e),s=t.getAttribute("data-microblog-settings");s&&0!=s.length||(s="{}");let a=JSON.parse(s);n.render(o.createElement(r.default,{settings:a}),t)}},169:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=s(0);window.moment=o},171:function(e,t,s){var o={"./af":20,"./af.js":20,"./ar":21,"./ar-dz":22,"./ar-dz.js":22,"./ar-kw":23,"./ar-kw.js":23,"./ar-ly":24,"./ar-ly.js":24,"./ar-ma":25,"./ar-ma.js":25,"./ar-sa":26,"./ar-sa.js":26,"./ar-tn":27,"./ar-tn.js":27,"./ar.js":21,"./az":28,"./az.js":28,"./be":29,"./be.js":29,"./bg":30,"./bg.js":30,"./bm":31,"./bm.js":31,"./bn":32,"./bn.js":32,"./bo":33,"./bo.js":33,"./br":34,"./br.js":34,"./bs":35,"./bs.js":35,"./ca":36,"./ca.js":36,"./cs":37,"./cs.js":37,"./cv":38,"./cv.js":38,"./cy":39,"./cy.js":39,"./da":40,"./da.js":40,"./de":41,"./de-at":42,"./de-at.js":42,"./de-ch":43,"./de-ch.js":43,"./de.js":41,"./dv":44,"./dv.js":44,"./el":45,"./el.js":45,"./en-au":46,"./en-au.js":46,"./en-ca":47,"./en-ca.js":47,"./en-gb":48,"./en-gb.js":48,"./en-ie":49,"./en-ie.js":49,"./en-il":50,"./en-il.js":50,"./en-nz":51,"./en-nz.js":51,"./eo":52,"./eo.js":52,"./es":53,"./es-do":54,"./es-do.js":54,"./es-us":55,"./es-us.js":55,"./es.js":53,"./et":56,"./et.js":56,"./eu":57,"./eu.js":57,"./fa":58,"./fa.js":58,"./fi":59,"./fi.js":59,"./fo":60,"./fo.js":60,"./fr":61,"./fr-ca":62,"./fr-ca.js":62,"./fr-ch":63,"./fr-ch.js":63,"./fr.js":61,"./fy":64,"./fy.js":64,"./gd":65,"./gd.js":65,"./gl":66,"./gl.js":66,"./gom-latn":67,"./gom-latn.js":67,"./gu":68,"./gu.js":68,"./he":69,"./he.js":69,"./hi":70,"./hi.js":70,"./hr":71,"./hr.js":71,"./hu":72,"./hu.js":72,"./hy-am":73,"./hy-am.js":73,"./id":74,"./id.js":74,"./is":75,"./is.js":75,"./it":76,"./it.js":76,"./ja":77,"./ja.js":77,"./jv":78,"./jv.js":78,"./ka":79,"./ka.js":79,"./kk":80,"./kk.js":80,"./km":81,"./km.js":81,"./kn":82,"./kn.js":82,"./ko":83,"./ko.js":83,"./ky":84,"./ky.js":84,"./lb":85,"./lb.js":85,"./lo":86,"./lo.js":86,"./lt":87,"./lt.js":87,"./lv":88,"./lv.js":88,"./me":89,"./me.js":89,"./mi":90,"./mi.js":90,"./mk":91,"./mk.js":91,"./ml":92,"./ml.js":92,"./mn":93,"./mn.js":93,"./mr":94,"./mr.js":94,"./ms":95,"./ms-my":96,"./ms-my.js":96,"./ms.js":95,"./mt":97,"./mt.js":97,"./my":98,"./my.js":98,"./nb":99,"./nb.js":99,"./ne":100,"./ne.js":100,"./nl":101,"./nl-be":102,"./nl-be.js":102,"./nl.js":101,"./nn":103,"./nn.js":103,"./pa-in":104,"./pa-in.js":104,"./pl":105,"./pl.js":105,"./pt":106,"./pt-br":107,"./pt-br.js":107,"./pt.js":106,"./ro":108,"./ro.js":108,"./ru":109,"./ru.js":109,"./sd":110,"./sd.js":110,"./se":111,"./se.js":111,"./si":112,"./si.js":112,"./sk":113,"./sk.js":113,"./sl":114,"./sl.js":114,"./sq":115,"./sq.js":115,"./sr":116,"./sr-cyrl":117,"./sr-cyrl.js":117,"./sr.js":116,"./ss":118,"./ss.js":118,"./sv":119,"./sv.js":119,"./sw":120,"./sw.js":120,"./ta":121,"./ta.js":121,"./te":122,"./te.js":122,"./tet":123,"./tet.js":123,"./tg":124,"./tg.js":124,"./th":125,"./th.js":125,"./tl-ph":126,"./tl-ph.js":126,"./tlh":127,"./tlh.js":127,"./tr":128,"./tr.js":128,"./tzl":129,"./tzl.js":129,"./tzm":130,"./tzm-latn":131,"./tzm-latn.js":131,"./tzm.js":130,"./ug-cn":132,"./ug-cn.js":132,"./uk":133,"./uk.js":133,"./ur":134,"./ur.js":134,"./uz":135,"./uz-latn":136,"./uz-latn.js":136,"./uz.js":135,"./vi":137,"./vi.js":137,"./x-pseudo":138,"./x-pseudo.js":138,"./yo":139,"./yo.js":139,"./zh-cn":140,"./zh-cn.js":140,"./zh-hk":141,"./zh-hk.js":141,"./zh-tw":142,"./zh-tw.js":142};function n(e){var t=r(e);return s(t)}function r(e){var t=o[e];if(!(t+1)){var s=new Error("Cannot find module '"+e+"'");throw s.code="MODULE_NOT_FOUND",s}return t}n.keys=function(){return Object.keys(o)},n.resolve=r,e.exports=n,n.id=171},172:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=s(3),n=s(173),r=s(9),l=s(282),a=s(5);t.default=class extends o.Component{componentDidMount(){const e=this.props.settings;e&&e.Member.ID&&l.default.dispatch(a.setUser(e.Member))}render(){return o.createElement(r.Provider,{store:l.default},o.createElement(n.default,{settings:this.props.settings}))}}},173:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=s(3),n=s(143),r=s(144),l=s(5),a=s(9),i=s(158),c=s(281);const u=a.connect(e=>({posts:e.microblog.posts,loading:e.microblog.postsLoading,filterCount:e.microblog.filterCount}),e=>({loadPosts:(t,s)=>e(l.loadPosts(t,s))}))(class extends o.Component{constructor(e){super(e),this.loadChildren=(()=>{})}getFilter(e="Filter"){const{settings:t}=this.props;let s=t[e];return!s&&t.Filter&&(s=t.Filter),s||(s={ParentID:"0"}),t.Target&&(s.Target=t.Target),s}getFilterString(e="FetchFilter"){let t=this.getFilter(e),s=[];for(var o in t)s.push(o+"="+t[o]);return s.join(";")}componentDidMount(){i.default.registerDataSource(c.default(this.getFilterString()))}componentWillUnmount(){i.default.removeDataSource(this.getFilterString())}render(){const{posts:e,settings:t,filterCount:s,loadPosts:l,loading:a}=this.props;let i=this.getFilter(),c=[];const u=!!t.SingleView;if(e)for(let t in e){const s=e[t];if(i){let e=!0;for(let t in i)if(s[t]!=i[t]){e=!1;break}e&&c.push(s)}else c.push(s)}let d=0,p=c.length;const m=this.getFilterString();s&&s[m]&&(d=s[m]);const f=t.Member&&t.Member.ID,g=t.Target?t.Target:null;return o.createElement("div",null,f>0&&!u&&o.createElement(r.default,{target:g}),a&&o.createElement("div",null,"Loading..."),o.createElement(n.default,{posts:c,loadChildren:()=>{l&&l(m,p)},expectedCount:d,loadMoreText:"Load more"}))}});t.default=u},174:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=s(3),n=s(144),r=s(9),l=s(5),a=s(143),i=s(197),c=r.connect(e=>{let t=[];for(var s in e.microblog.posts)t.push(e.microblog.posts[s]);return{allPosts:t,editId:e.microblog.editingPostId,replyId:e.microblog.replyToPostId,user:e.microblog.user}},(e,t)=>({onEdit:t=>e(l.editPost(t)),onDelete:t=>e(l.deletePost(t)),onReply:t=>e(l.replyToPost(t)),loadChildren:()=>e(l.loadPosts("ParentID="+t.post.ID)),votePost:(t,s)=>e(l.votePost(t,s))}))(e=>{const{post:t,allPosts:s,replyId:r,editId:l,showTitle:c,onEdit:u,onDelete:d,onReply:p,loadChildren:m,votePost:f,user:g}=e,j=s?s.filter(e=>e.ParentID==t.ID):[],P=parseInt(t.NumChildren);let _=parseInt(t.Up)-parseInt(t.Down);isNaN(_)&&(_=0);const h="0"==t.ParentID&&t.TargetInfo?JSON.parse(t.TargetInfo):{};return o.createElement("div",{className:t.ID==l?"MicroBlogPost MicroBlogPost--edited":"MicroBlogPost"},o.createElement("div",{className:"MicroBlogPost__Profile"},o.createElement("span",{className:"MicroBlogPost__Avatar"}),o.createElement("button",{className:"MicroBlogPost__VoteArrow",onClick:()=>f?f(t.ID,1):null},"⇧"),o.createElement("span",{className:"MicroBlogPost__PostScore"},_),o.createElement("button",{className:"MicroBlogPost__VoteArrow",onClick:()=>f?f(t.ID,-1):null},"⇩")),o.createElement("div",{className:"MicroBlogPost__Post"},o.createElement("div",{className:"MicroBlogPost__Author"},o.createElement("strong",{className:"MicroBlogPost__Author__Name"},t.Author),o.createElement("span",{className:"MicroBlogPost__Author__Created"},t.Created)),c&&o.createElement("div",{className:"MicroBlogPost__Title"},t.Title),o.createElement("div",{className:"MicroBlogPost__Content"},o.createElement(i,{escapeHtml:!1,source:t.Content})),"1"==t.CanEdit&&l===t.ID&&o.createElement("div",{className:"MicroBlogPost__EditPost"},o.createElement(n.default,{editPost:t})),r===t.ID&&o.createElement("div",{className:"MicroBlogPost__ReplyPost"},o.createElement(n.default,{extraProperties:{ParentID:r}})),h.Title&&o.createElement("div",{className:"MicroBlogPost__Target"},o.createElement("span",null,"Comment on ",o.createElement("a",{href:h.Link},h.Title))),o.createElement("div",{className:"MicroBlogPost__Actions"},o.createElement("a",{href:"/microblog/show/"+t.ID},"Link"),g&&o.createElement("button",{onClick:()=>{p&&p(t.ID)}},"Reply"),"1"==t.CanEdit&&o.createElement(o.Fragment,null,o.createElement("button",{onClick:()=>{u&&u(t.ID)}},"Edit"),o.createElement("button",{onClick:e=>{confirm("Delete this post?")&&d&&d(t.ID)}},"Delete"))),P>0&&o.createElement(a.default,{loadChildren:m,posts:j,expectedCount:parseInt(t.NumChildren)})))});t.default=c},196:function(e,t,s){e.exports=s.p+"images/marcus-ce0469b508acc49b560d5beeb5ec40d4.png"},281:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=s(159),n=s(5),r=s(8);t.default=(e=>({id:e,frequency:23,callback:function(t){let s=o.default("/api/v1/microblog/posts");e&&(s=s.query({filter:e})),t({type:r.ActionType.START_POSTS_LOAD}),s.get().json(s=>{s&&200==s.status&&s.payload.posts&&(t(n.loadPostsAction(s.payload.posts)),t(n.setFilterCounts(e,s.payload.remaining)))})}}))},282:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=s(148),n=s(283),r=s(8),l=s(284),a=s(158),i=o.combineReducers({microblog:l.default}),c=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||o.compose,u=o.createStore(i,c(o.applyMiddleware(n.default)));u.dispatch({type:r.ActionType.STORE_LOAD}),a.default.setStore(u),t.default=u},284:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=s(8),n={posts:{},users:{},postsLoading:!1,savingPost:!1,filterCount:{}},r={[o.ActionType.STORE_LOAD]:(e,t)=>({...e}),[o.ActionType.SET_USERS]:(e,t)=>{const s=t.users,o=Object.assign({},e.users);return s&&s.length>0&&s.forEach(e=>{o[e.ID]=e}),o?{...e,users:o}:e},[o.ActionType.SET_USER]:(e,t)=>{const s=t.user;return s?{...e,user:s}:e},[o.ActionType.EDIT_POST]:(e,t)=>({...e,editingPostId:t.postId}),[o.ActionType.UPDATING_POST]:(e,t)=>({...e,savingPost:t.value}),[o.ActionType.REPLY_TO_POST]:(e,t)=>({...e,replyToPostId:t.postId}),[o.ActionType.DELETE_POST]:(e,t)=>{let s={};for(let o in e.posts)o!=t.postId&&(s[o]=Object.assign({},e.posts[o]));return{...e,posts:s}},[o.ActionType.START_POSTS_LOAD]:(e,t)=>({...e,postsLoading:!0}),[o.ActionType.FILTER_COUNT]:(e,t)=>{let s={...e.filterCount,[t.filter]:t.total};return{...e,filterCount:s}},[o.ActionType.LOAD_POSTS]:(e,t)=>{let s=t.payload,o={};for(let t in e.posts)o[t]=Object.assign({},e.posts[t]);return s.forEach(e=>{o[e.ID]=e}),{...e,postsLoading:!1,posts:o}}};t.default=((e=n,t)=>r[t.type]?r[t.type].call(this,e,t):e)},285:function(e,t){},5:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=s(8),n=s(159);function r(e){return{type:o.ActionType.UPDATING_POST,value:e}}function l(e){return{type:o.ActionType.SET_USERS,users:e}}function a(e){return{type:o.ActionType.REPLY_TO_POST,postId:e}}function i(e){return{type:o.ActionType.EDIT_POST,postId:e}}function c(e,t){return{type:o.ActionType.FILTER_COUNT,filter:e,total:t}}function u(e){return{type:o.ActionType.LOAD_POSTS,payload:e}}t.setUser=function(e){return{type:o.ActionType.SET_USER,user:e}},t.createPost=function(e,t,s){s||(s={public:"1"});const o=t.target?t.target:null;return(l,i)=>{l(r(!0)),n.default("/api/v1/microblog/createPost").post({content:e,properties:t,to:s,target:o}).json(e=>{l(a(null));let s=[e.payload];if(t.ParentID){let e=i().microblog.posts[t.ParentID];e&&(e={...e,NumChildren:e.NumChildren+1},s.push(e))}return l(u(s))}).then(()=>{l(r(!1))}).catch(e=>{console.error(e),l(r(!1))})}},t.updatePost=function(e,t,s){return s=>{s(r(!0)),n.default("/api/v1/microblog/savePost").post({postID:t.ID,postClass:"MicroPost",data:{Content:e,Title:t.Title}}).json(e=>(s(i(null)),s(u([e.payload])))).then(()=>{s(r(!1))}).catch(e=>{console.error(e),s(r(!1))})}},t.votePost=function(e,t){return s=>{n.default("/api/v1/microblog/vote").post({postClass:"MicroPost",postID:e,dir:t}).json(e=>s(u([e.payload])))}},t.loadPosts=function(e="",t=0){let s={filter:e};return t>0&&(s.fromNumber=t),t=>{n.default("/api/v1/microblog/posts").query(s).get().json(s=>{s.payload&&s.payload.posts&&(t(c(e||"",s.payload.remaining)),t(u(s.payload.posts)),t(l(s.payload.users)))})}},t.deletePost=function(e){return(t,s)=>{n.default("/api/v1/microblog/deletePost").post({postId:e}).json(s=>{s&&s.status&&200==s.status&&t({type:o.ActionType.DELETE_POST,postId:e})}).catch(e=>{console.error("Failed deleting post",e)})}},t.savingPost=r,t.setUsers=l,t.replyToPost=a,t.editPost=i,t.setFilterCounts=c,t.loadPostsAction=u},8:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ActionType={STORE_LOAD:"STORE_LOAD",SET_USER:"SET_USER",SET_USERS:"SET_USERS",START_POSTS_LOAD:"START_POSTS_LOAD",LOAD_POSTS:"LOAD_POSTS",UPDATING_POST:"UPDATING_POST",REPLY_TO_POST:"REPLY_TO_POST",EDIT_POST:"EDIT_POST",DELETE_POST:"DELETE_POST",FILTER_COUNT:"FILTER_COUNT"}}});
//# sourceMappingURL=main.bundle.js.map